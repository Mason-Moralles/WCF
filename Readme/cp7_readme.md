–ö–æ–Ω—Ç—Ä–æ–ª—å–Ω–∞—è —Ç–æ—á–∫–∞ 7
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –∫–∞–Ω–∞–ª –∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –∫–æ–¥–µ—Ä —Å–æ–æ–±—â–µ–Ω–∏–π –≤ WCF (Custom Binding + TCP)

–¶–µ–ª—å –ö–¢7 ‚Äî –æ—Å–≤–æ–∏—Ç—å –Ω–∏–∑–∫–æ—É—Ä–æ–≤–Ω–µ–≤—ã–µ –º–µ—Ö–∞–Ω–∏–∑–º—ã WCF –ø—É—Ç—ë–º —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –∫–∞—Å—Ç–æ–º–Ω–æ–≥–æ —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–∞ (TCP) –∏ –∫–∞—Å—Ç–æ–º–Ω–æ–≥–æ message encoder-–∞, –∫–æ—Ç–æ—Ä—ã–µ —Å–æ–≤–º–µ—Å—Ç–Ω–æ —Ñ–æ—Ä–º–∏—Ä—É—é—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫—É—é binding.
–í —Ä–∞–º–∫–∞—Ö –∑–∞–¥–∞–Ω–∏—è —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ —Å–ª—É–∂–±–∞ WCF –∏ –∫–ª–∏–µ–Ω—Ç, –æ–±–º–µ–Ω–∏–≤–∞—é—â–∏–µ—Å—è SOAP-—Å–æ–æ–±—â–µ–Ω–∏—è–º–∏ —á–µ—Ä–µ–∑ –ø–æ–ª–Ω–æ—Å—Ç—å—é –∫–∞—Å—Ç–æ–º–Ω—ã–π —Å—Ç–µ–∫.

üìå 1. –¶–µ–ª—å —Ä–∞–±–æ—Ç—ã

–†–∞–∑—Ä–∞–±–æ—Ç–∞—Ç—å WCF-—Å–ª—É–∂–±—É, –∏—Å–ø–æ–ª—å–∑—É—é—â—É—é –∫–∞—Å—Ç–æ–º–Ω—ã–π –∫–∞–Ω–∞–ª –∏ –∫–∞—Å—Ç–æ–º–Ω—ã–π message encoder.

–†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç –Ω–∞ –æ—Å–Ω–æ–≤–µ TCP.

–†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–π encoder, –ª–æ–≥–∏—Ä—É—é—â–∏–π SOAP-—Å–æ–æ–±—â–µ–Ω–∏—è –ø—Ä–∏ —á—Ç–µ–Ω–∏–∏ –∏ –∑–∞–ø–∏—Å–∏.

–°–æ–∑–¥–∞—Ç—å —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—É—é Binding, –∫–æ—Ç–æ—Ä–∞—è –æ–±—ä–µ–¥–∏–Ω—è–µ—Ç encoder –∏ —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç.

–†–∞–∑—Ä–∞–±–æ—Ç–∞—Ç—å –∫–ª–∏–µ–Ω—Ç—Å–∫–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ, –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤—É—é—â–µ–µ —Å —Å–µ—Ä–≤–∏—Å–æ–º —á–µ—Ä–µ–∑ —ç—Ç—É binding.

–í—Å–µ –ø—É–Ω–∫—Ç—ã –¢–ó –≤—ã–ø–æ–ª–Ω–µ–Ω—ã.

üìå 2. –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Ä–µ—à–µ–Ω–∏—è
–ü—Ä–æ–µ–∫—Ç—ã –≤ solution:

WcfServiceLibrary1
–°–æ–¥–µ—Ä–∂–∏—Ç:

–ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å —Å–µ—Ä–≤–∏—Å–∞ –∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é (ICustomChannelService, CustomChannelService).

–í—Å–µ –∫–ª–∞—Å—Å—ã –ö–¢7:

CustomMessageEncoder

CustomMessageEncoderFactory

CustomMessageEncodingBindingElement

CustomTcpBinding

WcfServiceHost
Self-host, –ø–æ–¥–Ω–∏–º–∞—é—â–∏–π —Å–µ—Ä–≤–∏—Å –ø–æ –∞–¥—Ä–µ—Å—É:

net.tcp://localhost:9001/CustomChannelService


–∏ –∏—Å–ø–æ–ª—å–∑—É—é—â–∏–π CustomTcpBinding.

CustomChannelClient
–ö–æ–Ω—Å–æ–ª—å–Ω—ã–π –∫–ª–∏–µ–Ω—Ç, —Å–æ–∑–¥–∞—é—â–∏–π –∫–∞–Ω–∞–ª —á–µ—Ä–µ–∑ CustomTcpBinding –∏ –≤—ã–ø–æ–ª–Ω—è—é—â–∏–π –≤—ã–∑–æ–≤ Echo.

üìå 3. –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã (–ö–¢7)
‚úî 3.1. –ö–æ–Ω—Ç—Ä–∞–∫—Ç —Å–µ—Ä–≤–∏—Å–∞
[ServiceContract]
public interface ICustomChannelService
{
    [OperationContract]
    string Echo(string message);
}

‚úî 3.2. –†–µ–∞–ª–∏–∑–∞—Ü–∏—è —Å–µ—Ä–≤–∏—Å–∞
public class CustomChannelService : ICustomChannelService
{
    public string Echo(string message)
    {
        Console.WriteLine($"[Service] –ü–æ–ª—É—á–µ–Ω–æ —Å–æ–æ–±—â–µ–Ω–∏–µ: {message}");
        return $"Echo from custom TCP+encoder: {message}";
    }
}

üìå 4. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π message encoder
‚úî CustomMessageEncoder

–†–∞—Å—à–∏—Ä—è–µ—Ç —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π TextMessageEncoder –∏ –ª–æ–≥–∏—Ä—É–µ—Ç:

–≤—Ö–æ–¥—è—â–∏–µ SOAP-—Å–æ–æ–±—â–µ–Ω–∏—è (ReadMessage)

–∏—Å—Ö–æ–¥—è—â–∏–µ SOAP-—Å–æ–æ–±—â–µ–Ω–∏—è (WriteMessage)

–¢–∞–∫–∏–º –æ–±—Ä–∞–∑–æ–º –¥–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä—É–µ—Ç—Å—è –≤–º–µ—à–∞—Ç–µ–ª—å—Å—Ç–≤–æ –≤ –ø—Ä–æ—Ü–µ—Å—Å –∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏—è.

–ü—Ä–∏–º–µ—Ä —Ñ—Ä–∞–≥–º–µ–Ω—Ç–∞ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è:

[Encoder] WriteMessage (buffer):
<s:Envelope xmlns:s="http://schemas.xmlsoap.org/soap/envelope/">
    ...
</s:Envelope>

‚úî CustomMessageEncoderFactory

–§–∞–±—Ä–∏–∫–∞ encoder'–æ–≤, –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–∞—è —á–∞—Å—Ç—å WCF pipeline.
–ü–æ–∑–≤–æ–ª—è–µ—Ç –ø—Ä–∏–≤—è–∑–∫–µ —Å–æ–∑–¥–∞–≤–∞—Ç—å —ç–∫–∑–µ–º–ø–ª—è—Ä—ã CustomMessageEncoder.

‚úî CustomMessageEncodingBindingElement

BindingElement, –ø–æ–¥–∫–ª—é—á–∞—é—â–∏–π encoder –≤ —Å—Ç–µ–∫ binding.

üìå 5. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç (TCP)
‚úî CustomTcpBinding

–§–æ—Ä–º–∏—Ä—É–µ—Ç binding:

[CustomMessageEncodingBindingElement]
[TcpTransportBindingElement (—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π)]


–¢–∞–∫–∏–º –æ–±—Ä–∞–∑–æ–º —Å—Ç–µ–∫ —Å–æ–æ–±—â–µ–Ω–∏–π –≤—ã–≥–ª—è–¥–∏—Ç —Ç–∞–∫:

CustomMessageEncoder ‚Üí SOAP ‚Üí TCP Transport ‚Üí –°–µ—Ç—å


–î–∞–Ω–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç –∑–∞–∫—Ä—ã–≤–∞–µ—Ç —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–µ —Ä–∞–±–æ—Ç—ã –ø–æ–≤–µ—Ä—Ö TCP.

üìå 6. Self-host: —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —Å–µ—Ä–≤–∏—Å–∞

–í WcfServiceHost:

var customHost = new ServiceHost(
    typeof(CustomChannelService),
    new Uri("net.tcp://localhost:9001/CustomChannelService"));

customHost.AddServiceEndpoint(
    typeof(ICustomChannelService),
    new CustomTcpBinding(),
    "");

üìå 7. –ö–ª–∏–µ–Ω—Ç—Å–∫–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ (CustomChannelClient)

–ö–ª–∏–µ–Ω—Ç –Ω–∞–ø—Ä—è–º—É—é –∏—Å–ø–æ–ª—å–∑—É–µ—Ç CustomTcpBinding –±–µ–∑ App.config:

var binding = new CustomTcpBinding();
var address = new EndpointAddress("net.tcp://localhost:9001/CustomChannelService");

var factory = new ChannelFactory<ICustomChannelService>(binding, address);
var client = factory.CreateChannel();


–ü—Ä–∏–º–µ—Ä –∫–æ–Ω—Å–æ–ª—å–Ω–æ–≥–æ –¥–∏–∞–ª–æ–≥–∞:

> Hello KT7
–û—Ç–≤–µ—Ç —Å–µ—Ä–≤–∏—Å–∞: Echo from custom TCP+encoder: Hello KT7

üìå 8. –î–æ–∫–∞–∑–∞—Ç–µ–ª—å—Å—Ç–≤–æ —Ä–∞–±–æ—Ç—ã encoder'–∞

–í –∫–æ–Ω—Å–æ–ª–∏ —Ö–æ—Å—Ç–∞ –≤—ã–≤–æ–¥—è—Ç—Å—è:

SOAP-—Å–æ–æ–±—â–µ–Ω–∏—è –≤—Ö–æ–¥—è—â–µ–≥–æ –≤—ã–∑–æ–≤–∞

SOAP-—Å–æ–æ–±—â–µ–Ω–∏—è –æ—Ç–≤–µ—Ç–∞

–ü—Ä–∏–º–µ—Ä:

[Encoder] ReadMessage (buffer):
<s:Envelope xmlns:s="http://schemas.xmlsoap.org/soap/envelope/">
    ...
</s:Envelope>

[Service] –ü–æ–ª—É—á–µ–Ω–æ —Å–æ–æ–±—â–µ–Ω–∏–µ: Hello KT7


–≠—Ç–æ –¥–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä—É–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω—É—é —Ä–∞–±–æ—Ç—É –∫–∞—Å—Ç–æ–º–Ω–æ–≥–æ message encoder'–∞.
