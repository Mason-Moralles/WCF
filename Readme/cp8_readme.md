RPC-—Å–ª—É–∂–±–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∑–∞–∫–∞–∑–∞–º–∏ –≤ WCF (—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ –∏ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ –≤—ã–∑–æ–≤—ã)

–î–∞–Ω–Ω–∞—è —Ä–∞–±–æ—Ç–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∞ –≤ —Ä–∞–º–∫–∞—Ö –ö–¢8 –∏ –¥–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä—É–µ—Ç —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é RPC-–ø–æ–¥—Ö–æ–¥–∞ –≤ WCF —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º —Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã—Ö –∏ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã—Ö –∫–æ–Ω—Ç—Ä–∞–∫—Ç–æ–≤.
–ü—Ä–æ–µ–∫—Ç —Å–æ—Å—Ç–æ–∏—Ç –∏–∑ WCF-—Å–ª—É–∂–±—ã —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∑–∞–∫–∞–∑–∞–º–∏ –∏ –∫–ª–∏–µ–Ω—Ç—Å–∫–æ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è, –∫–æ—Ç–æ—Ä–æ–µ –≤—ã–∑—ã–≤–∞–µ—Ç –º–µ—Ç–æ–¥—ã —Å–µ—Ä–≤–∏—Å–∞ —á–µ—Ä–µ–∑ BasicHttpBinding.

üìå 1. –¶–µ–ª—å —Ä–∞–±–æ—Ç—ã

–°–æ–∑–¥–∞—Ç—å WCF-—Å–ª—É–∂–±—É, —Ä–µ–∞–ª–∏–∑—É—é—â—É—é RPC-–≤—ã–∑–æ–≤—ã, –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∑–∞–∫–∞–∑–∞–º–∏:

–°–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –∫–æ–Ω—Ç—Ä–∞–∫—Ç: –ø–æ–ª—É—á–µ–Ω–∏–µ, –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –∏ –ø–æ–∏—Å–∫ –∑–∞–∫–∞–∑–æ–≤.

–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –∫–æ–Ω—Ç—Ä–∞–∫—Ç: —Ç–æ –∂–µ —Å–∞–º–æ–µ, –Ω–æ —á–µ—Ä–µ–∑ Task<>.

DataContract-–∫–ª–∞—Å—Å—ã –¥–ª—è –æ–ø–∏—Å–∞–Ω–∏—è –∑–∞–∫–∞–∑–æ–≤.

–ö–ª–∏–µ–Ω—Ç, –∏—Å–ø–æ–ª—å–∑—É—é—â–∏–π RPC-–ø–æ–¥—Ö–æ–¥ —á–µ—Ä–µ–∑ ChannelFactory<T>.

–†–∞–±–æ—Ç–∞ –¥–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä—É–µ—Ç –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ RPC –≤ WCF –∏ —Ä–∞–±–æ—Ç—É —Å —Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–º–∏/–∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–º–∏ –º–µ—Ç–æ–¥–∞–º–∏.

üìå 2. –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Ä–µ—à–µ–Ω–∏—è

–†–µ—à–µ–Ω–∏–µ –≤–∫–ª—é—á–∞–µ—Ç —Ç—Ä–∏ –æ—Å–Ω–æ–≤–Ω—ã—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞:

1. –ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ WCF (WcfServiceLibrary1)

–°–æ–¥–µ—Ä–∂–∏—Ç:

DataContract-–∫–ª–∞—Å—Å—ã:

Order8

OrderItem8

–ö–æ–Ω—Ç—Ä–∞–∫—Ç—ã:

IOrderService8 (—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π)

IOrderService8Async (–∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π)

–†–µ–∞–ª–∏–∑–∞—Ü–∏–∏:

OrderService8

OrderService8Async

–°—Ç–∞—Ç–∏—á–µ—Å–∫–∏–π —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π OrderStore8 ‚Äî –æ–±—â–∞—è –∫–æ–ª–ª–µ–∫—Ü–∏—è –∑–∞–∫–∞–∑–æ–≤.

2. Self-host (WcfServiceHost)

–ü–æ–¥–Ω–∏–º–∞–µ—Ç –¥–≤–∞ —Å–µ—Ä–≤–∏—Å–∞:

http://localhost:8760/OrderService8
http://localhost:8760/OrderService8Async


–û–±–∞ –∏—Å–ø–æ–ª—å–∑—É—é—Ç BasicHttpBinding, —á—Ç–æ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç RPC-–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—é WCF.

3. –ö–ª–∏–µ–Ω—Ç (OrderRpcClient)

–ö–æ–Ω—Å–æ–ª—å–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ, –≤—ã–ø–æ–ª–Ω—è—é—â–µ–µ:

–°–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ –≤—ã–∑–æ–≤—ã (IOrderService8)

–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ –≤—ã–∑–æ–≤—ã (IOrderService8Async)

–ß–µ—Ä–µ–∑:

new ChannelFactory<IOrderService8>(binding, endpoint);


—á—Ç–æ –∏ —Ä–µ–∞–ª–∏–∑—É–µ—Ç RPC-–ø–æ–¥—Ö–æ–¥.

üìå 3. DataContract-–∫–ª–∞—Å—Å—ã

–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤–ª–æ–∂–µ–Ω–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞: –∑–∞–∫–∞–∑ + —Å–ø–∏—Å–æ–∫ —Ç–æ–≤–∞—Ä–Ω—ã—Ö –ø–æ–∑–∏—Ü–∏–π.

[DataContract]
public class OrderItem8
{
    [DataMember] public int ProductId { get; set; }
    [DataMember] public string ProductName { get; set; }
    [DataMember] public int Quantity { get; set; }
}

[DataContract]
public class Order8
{
    [DataMember] public int OrderId { get; set; }
    [DataMember] public string CustomerName { get; set; }
    [DataMember] public DateTime CreatedAt { get; set; }
    [DataMember] public List<OrderItem8> Items { get; set; } = new();
}

üìå 4. –°–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –∫–æ–Ω—Ç—Ä–∞–∫—Ç –∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è
IOrderService8
[ServiceContract]
public interface IOrderService8
{
    [OperationContract] List<Order8> GetOrders();
    [OperationContract] Order8 GetOrderById(int id);
    [OperationContract] void AddOrder(Order8 order);
}

OrderService8
public class OrderService8 : IOrderService8
{
    public List<Order8> GetOrders() => OrderStore8.GetAll();
    public Order8 GetOrderById(int id) => OrderStore8.GetById(id);
    public void AddOrder(Order8 order) => OrderStore8.Add(order);
}

üìå 5. –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –∫–æ–Ω—Ç—Ä–∞–∫—Ç –∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è
IOrderService8Async
[ServiceContract]
public interface IOrderService8Async
{
    [OperationContract] Task<List<Order8>> GetOrdersAsync();
    [OperationContract] Task<Order8> GetOrderByIdAsync(int id);
    [OperationContract] Task AddOrderAsync(Order8 order);
}

OrderService8Async
public class OrderService8Async : IOrderService8Async
{
    public Task<List<Order8>> GetOrdersAsync() => Task.FromResult(OrderStore8.GetAll());
    public Task<Order8> GetOrderByIdAsync(int id) => Task.FromResult(OrderStore8.GetById(id));
    public Task AddOrderAsync(Order8 order) { OrderStore8.Add(order); return Task.CompletedTask; }
}

üìå 6. –ü–æ–¥–Ω—è—Ç–∏–µ —Å–µ—Ä–≤–∏—Å–æ–≤ –≤ Self-host

–í WcfServiceHost –æ–±–∞ —Å–µ—Ä–≤–∏—Å–∞ –ø–æ–¥–Ω–∏–º–∞—é—Ç—Å—è —Ç–∞–∫:

var orderHost8 = new ServiceHost(
    typeof(OrderService8),
    new Uri("http://localhost:8760/OrderService8"));
orderHost8.AddServiceEndpoint(typeof(IOrderService8), new BasicHttpBinding(), "");

var orderHost8Async = new ServiceHost(
    typeof(OrderService8Async),
    new Uri("http://localhost:8760/OrderService8Async"));
orderHost8Async.AddServiceEndpoint(typeof(IOrderService8Async), new BasicHttpBinding(), "");

üìå 7. RPC-–∫–ª–∏–µ–Ω—Ç (OrderRpcClient)

–ö–ª–∏–µ–Ω—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç ChannelFactory<T> ‚Äî —ç—Ç–æ –∫–ª—é—á–µ–≤–æ–π –ø—Ä–∏–∑–Ω–∞–∫ RPC:

var factory = new ChannelFactory<IOrderService8>(
    new BasicHttpBinding(),
    new EndpointAddress("http://localhost:8760/OrderService8"));

var client = factory.CreateChannel();


–ö–ª–∏–µ–Ω—Ç –¥–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä—É–µ—Ç:

–ø–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –∑–∞–∫–∞–∑–æ–≤

–¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –∑–∞–∫–∞–∑–∞

–ø–æ–∏—Å–∫ –ø–æ ID

–∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ –≤–µ—Ä—Å–∏–∏ —Ç–µ—Ö –∂–µ –æ–ø–µ—Ä–∞—Ü–∏–π

RPC-–≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ –≤—ã–≥–ª—è–¥–∏—Ç –∫–∞–∫ –æ–±—ã—á–Ω—ã–π –≤—ã–∑–æ–≤ –ª–æ–∫–∞–ª—å–Ω—ã—Ö –º–µ—Ç–æ–¥–æ–≤:

var result = client.GetOrders();   // sync
var result2 = await client.GetOrdersAsync(); // async

üìå 8. –î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è —Ä–∞–±–æ—Ç—ã
–°–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –≤—ã–∑–æ–≤:
=== –°–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ –≤—ã–∑–æ–≤—ã IOrderService8 ===
–í—Å–µ–≥–æ –∑–∞–∫–∞–∑–æ–≤: 2
–î–æ–±–∞–≤–ª–µ–Ω –Ω–æ–≤—ã–π –∑–∞–∫–∞–∑ –¥–ª—è Charlie.
–ó–∞–∫–∞–∑ #1: Alice

–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –≤—ã–∑–æ–≤:
=== –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ –≤—ã–∑–æ–≤—ã IOrderService8Async ===
[Async] –í—Å–µ–≥–æ –∑–∞–∫–∞–∑–æ–≤: 3
[Async] –ó–∞–∫–∞–∑ #2: Bob
[Async] –î–æ–±–∞–≤–ª–µ–Ω –∑–∞–∫–∞–∑ –¥–ª—è AsyncUser.
[Async] –ó–∞–∫–∞–∑–æ–≤ –ø–æ—Å–ª–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è: 4

üìå 9. –í—ã–≤–æ–¥

‚úî —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω WCF-—Å–µ—Ä–≤–∏—Å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∑–∞–∫–∞–∑–∞–º–∏ –≤ RPC-—Å—Ç–∏–ª–µ
‚úî —Å–æ–∑–¥–∞–Ω—ã DataContract-–∫–ª–∞—Å—Å—ã –∑–∞–∫–∞–∑–æ–≤
‚úî —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã —Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ –∏ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ –∫–æ–Ω—Ç—Ä–∞–∫—Ç—ã
‚úî –≤—ã–ø–æ–ª–Ω–µ–Ω–∞ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è —Å–µ—Ä–≤–∏—Å–æ–≤
‚úî —Å–µ—Ä–≤–∏—Å—ã —Ä–∞–∑–º–µ—â–µ–Ω—ã –≤ self-host
‚úî —Ä–∞–∑—Ä–∞–±–æ—Ç–∞–Ω –∫–ª–∏–µ–Ω—Ç, –≤—ã–ø–æ–ª–Ω—è—é—â–∏–π RPC-–≤—ã–∑–æ–≤—ã
‚úî –ø—Ä–æ–¥–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∞ —Ä–∞–±–æ—Ç–∞ sync/async RPC