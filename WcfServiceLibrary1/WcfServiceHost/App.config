<?xml version="1.0" encoding="utf-8"?>
<configuration>
  <system.serviceModel>

    <!-- ====================== -->
    <!--     ВСЕ СЕРВИСЫ        -->
    <!-- ====================== -->
    <services>

      <!-- КТ2: Users + SQLite -->
      <service name="WcfServiceLibrary1.Service1"
               behaviorConfiguration="Service1Behavior">

        <host>
          <baseAddresses>
            <add baseAddress="http://localhost:8733/Design_Time_Addresses/KT1/Service1/" />
          </baseAddresses>
        </host>

        <endpoint address=""
                  binding="basicHttpBinding"
                  contract="WcfServiceLibrary1.IService1" />

        <endpoint address="mex"
                  binding="mexHttpBinding"
                  contract="IMetadataExchange" />
      </service>


      <!-- КТ4: EmployeeService -->
      <service name="WcfServiceLibrary1.EmployeeService"
               behaviorConfiguration="EmployeeServiceBehavior">

        <host>
          <baseAddresses>
            <add baseAddress="http://localhost:8734/EmployeeService/" />
          </baseAddresses>
        </host>

        <endpoint address=""
                  binding="basicHttpBinding"
                  contract="WcfServiceLibrary1.IEmployeeService" />

        <endpoint address="mex"
                  binding="mexHttpBinding"
                  contract="IMetadataExchange" />
      </service>


      <!-- КТ5: OrderService -->
      <service name="WcfServiceLibrary1.OrderService"
               behaviorConfiguration="OrderServiceBehavior">

        <host>
          <baseAddresses>
            <add baseAddress="http://localhost:8735/OrderService/" />
          </baseAddresses>
        </host>

        <endpoint address=""
                  binding="basicHttpBinding"
                  contract="WcfServiceLibrary1.IOrderService" />

        <endpoint address="mex"
                  binding="mexHttpBinding"
                  contract="IMetadataExchange" />
      </service>


      <!-- ================================ -->
      <!--  КТ6: SecurityService + WS-Security -->
      <!-- ================================ -->
      <service name="WcfServiceLibrary1.SecurityService"
               behaviorConfiguration="SecureBehavior">

        <host>
          <baseAddresses>
            <add baseAddress="http://localhost:8740/SecurityService/" />
          </baseAddresses>
        </host>

        <!-- Основной WS-Security endpoint -->
        <endpoint address=""
                  binding="wsHttpBinding"
                  bindingConfiguration="UsernameBinding"
                  contract="WcfServiceLibrary1.ISecurityService" />

        <!-- MEX endpoint -->
        <endpoint address="mex"
                  binding="mexHttpBinding"
                  contract="IMetadataExchange" />
      </service>

    </services>


    <!-- ====================== -->
    <!--     НАСТРОЙКИ BINDINGS -->
    <!-- ====================== -->
    <bindings>
      <wsHttpBinding>
        <binding name="UsernameBinding">
          <security mode="Message">
            <message clientCredentialType="UserName" />
          </security>
        </binding>
      </wsHttpBinding>
    </bindings>


    <!-- ====================== -->
    <!--     BEHAVIORS           -->
    <!-- ====================== -->
    <behaviors>
      <serviceBehaviors>

        <behavior name="Service1Behavior">
          <serviceMetadata httpGetEnabled="true"/>
          <serviceDebug includeExceptionDetailInFaults="true"/>
        </behavior>

        <behavior name="EmployeeServiceBehavior">
          <serviceMetadata httpGetEnabled="true"/>
          <serviceDebug includeExceptionDetailInFaults="true"/>
        </behavior>

        <behavior name="OrderServiceBehavior">
          <serviceMetadata httpGetEnabled="true"/>
          <serviceDebug includeExceptionDetailInFaults="true"/>
        </behavior>

        <!-- SecurityService behavior -->
        <behavior name="SecureBehavior">
          <serviceCredentials>

            <!-- Кастомная аутентификация логин/пароль -->
            <userNameAuthentication 
                userNamePasswordValidationMode="Custom"
                customUserNamePasswordValidatorType="WcfServiceHost.SimpleUserValidator, WcfServiceHost" />

            <!-- Сертификат службы (исправленный, по thumbprint) -->
            <serviceCertificate
                findValue="31E4AE7B6BC65B87603202A64FC6BE22164C0B1C"
                x509FindType="FindByThumbprint"
                storeLocation="CurrentUser"
                storeName="My" />
          </serviceCredentials>

          <serviceMetadata httpGetEnabled="true"/>
          <serviceDebug includeExceptionDetailInFaults="true"/>
        </behavior>

      </serviceBehaviors>
    </behaviors>

  </system.serviceModel>


  <!-- SQLite runtime -->
  <runtime>
    <assemblyBinding xmlns="urn:schemas-microsoft-com:asm.v1">
      <dependentAssembly>
        <assemblyIdentity name="SQLitePCLRaw.core" publicKeyToken="1488e028ca7ab535" culture="neutral" />
        <bindingRedirect oldVersion="0.0.0.0-2.1.11.2622" newVersion="2.1.11.2622" />
      </dependentAssembly>
    </assemblyBinding>
  </runtime>

</configuration>
